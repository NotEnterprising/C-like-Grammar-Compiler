### 错误处理

#### 1 符号表

##### 1.1 符号表的建立

符号表在编译程序工作的过程中需要不断收集、记录和使用源程序中一些语法符号的类型和特征等相关信息。这些信息一般以表格形式存储于系统中。如常数表、变量名表、数组名表、过程名表、标号表等等，统称为符号表。对于符号表组织、构造和管理方法的好坏会直接影响编译系统的运行效率。

##### 1.2 $symbolTable.cpp$

```c++
typedef struct {
	std::string name;
	int type;
	int kind;
	int length;		
	int lineNum;	
}tableItem;
```

```c++
extern std::map<std::string, tableItem> globalSymbolTable;
extern std::map<std::string, std::map<std::string, tableItem>> funcSymbolTable;
```

#### 2 错误处理

##### 2.1 错误类型分析

| 错误类型 | 情况                                                      |
| -------- | --------------------------------------------------------- |
| a        | 词法分析内字符内有非法字符或字符串为空                    |
| b        | 在符号表同一个域内有重名\(不区分大小写\)                  |
| c        | 引用未定义的函数名或者变量名                              |
| d        | 参数表遍历时参数数量不匹配                                |
| e        | 参数表遍历时参数类型不匹配                                |
| f        | 条件判断左右条件的返回类型应该只能为整型                  |
| g        | return表达式类型不匹配或者return\(\)                      |
| h        | 无return语句，return表达式类型不匹配，return;，return\(\) |
| i        | 数组下标表达式必须是整型                                  |
| j        | 读语句和赋值语句的左侧标识符不能是常量                    |
| k        | 常量说明变量说明或者语句后面缺少分号                      |
| l        | 函数定义或者语句里缺少右小括号                            |
| m        | 数组缺右中括号                                            |
| n        | 变量定义及初始化给数组赋值时需要维数对应                  |
| o        | 变量定义读入数组或者情况语句中常量类型不匹配              |
| p        | switch语句后没有default语句                               |

##### 2.2 $error.cpp$

```c++
class error {
public:
	error(std::ofstream& output);

	std::ofstream& fileOutput;
	void errorPrint(char flag, int currentLine);
};
```

##### 2.3 错误处理实现

编译程序对于语法和语义正确的源程序要正确地编译生成等价的目标代码；而对于错误的源程序不能一发现就停止，而是要能检查出错误的性质和出错位置，并使编译能继续下去，同时尽可能多而准确地发现错误和指出各种错误。

- 诊察各类错误的能力。
- 报错及时准确（出错位置，错误性质）。
- 一次编译找出错误的多少。
- 改正错误的能力。
- 遏制重复错误信息的能力。

